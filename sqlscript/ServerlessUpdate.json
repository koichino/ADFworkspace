{
	"name": "ServerlessUpdate",
	"properties": {
		"content": {
			"query": "CREATE DATABASE koichinodb\nGO\nCREATE MASTER KEY ENCRYPTION BY PASSWORD = '1qazxsw2#EDC'\nGO\nCREATE DATABASE SCOPED CREDENTIAL koichinocre1\nWITH IDENTITY='SHARED ACCESS SIGNATURE',  \nSECRET = 'sv=2021-08-06&ss=btqf&srt=sco&st=2022-11-04T07%3A12%3A13Z&se=2026-12-05T07%3A12%3A00Z&sp=rwdl&sig=Y%2F9eI4YagwL2BoZEs1wDq5UxGJIhp1aqcOXDLPfix%2FY%3D'\nGO\nCREATE EXTERNAL DATA SOURCE koichinogen2 WITH (\n    LOCATION = 'https://koichinoadlsgen2.dfs.core.windows.net/tpcds',\n    CREDENTIAL = koichinocre1\n);\nGO\nCREATE EXTERNAL FILE FORMAT ParquetFormat WITH (  FORMAT_TYPE = PARQUET );\n\nSELECT top 1000 *\n--SELECT count(*)\nFROM OPENROWSET\n  (\n      BULK '/item/*.parquet',\n      DATA_SOURCE = 'koichinogen2',\n      FORMAT='PARQUET'\n  ) AS item\n\n\nUSE koichinodb;\nGO\nCREATE EXTERNAL TABLE et_item\n(\n[i_item_sk] smallint,\n[i_item_id] VARCHAR (16),\n[i_rec_start_date] VARCHAR (30),\n[i_rec_end_date] VARCHAR (30),\n[i_item_desc] VARCHAR (200),\n[i_current_price] FLOAT,\n[i_wholesale_cost] FLOAT,\n[i_brand_id] bigint,\n[i_brand] VARCHAR (50),\n[i_class_id] smallint,\n[i_class] VARCHAR (50),\n[i_category_id] smallint,\n[i_category] VARCHAR (50),\n[i_manufact_id] smallint,\n[i_manufact] VARCHAR (50),\n[i_size] VARCHAR (20),\n[i_formulation]  VARCHAR (20),\n[i_color]  VARCHAR (20),\n[i_units] VARCHAR (10),\n[i_container] VARCHAR (10),\n[i_manager_id] smallint,\n[i_product_name] VARCHAR (50)\n)\nWITH (\n    LOCATION = '/item/*.parquet',\n    DATA_SOURCE = koichinogen2,\n    FILE_FORMAT = ParquetFormat\n);\nGO\n\n\n--\n\nSELECT top 1000 *\n--SELECT count(*)\nFROM et_item\n\n\n\n\n--drop CREDENTIAL sqlondemand\n\n\nCREATE EXTERNAL FILE FORMAT QuotedCsvWithHeaderFormat\nWITH (  \n    FORMAT_TYPE = DELIMITEDTEXT,\n    FORMAT_OPTIONS ( FIELD_TERMINATOR = ',', STRING_DELIMITER = '\"', FIRST_ROW = 2   )\n);\nGO\n\n\n/*\nselect \n    JSON_VALUE (doc, '$[0].sparkApplicationId') AS sparkApplicationId,\n    JSON_VALUE (doc, '$[0].queryId') AS queryId,\n    JSON_VALUE (doc, '$[0].runTimes.startTime') AS startTime,\n    JSON_VALUE (doc, '$[0].runTimes.endTime') AS endTime,\n    JSON_VALUE (doc, '$[0].runTimes.executionTimeMs') AS executionTimeMs,\n    JSON_VALUE (doc, '$[0].queryResultValidationSuccess') AS queryResultValidationSuccess,\n    JSON_VALUE (doc, '$[0].fileScanTimeMs') AS fileScanTimeMs,\n    JSON_VALUE (doc, '$[0].percentTimeInFileScan') AS percentTimeInFileScan,\n    JSON_VALUE (doc, '$[0].fileListingTimeMs') AS fileListingTimeMs,\n    JSON_VALUE (doc, '$[0].sortSpillSize') AS sortSpillSize,\n    JSON_VALUE (doc, '$[0].aggregateSpillSize') AS aggregateSpillSize\nfrom openrowset(\n--      bulk 'https://koichinogen24synapse.dfs.core.windows.net/synapsews/rakutenpoc/1st/*/*Json',\n      bulk 'https://koichinogen24synapse.dfs.core.windows.net/synapsews/rakutenpoc/2nd/*/*Json',\n--      bulk 'https://koichinogen24synapse.dfs.core.windows.net/synapsews/rakutenpoc/3rd/*/*Json',\n        format = 'csv',\n        fieldterminator ='0x0b',\n        fieldquote = '0x0b'\n    ) with (doc nvarchar(max)) as rows\nOrder by queryId ASC\ngo\nselect top 10 *\nfrom openrowset(\n        bulk 'https://koichinogen24synapse.dfs.core.windows.net/synapsews/rakutenpoc/1st/*/*Json',\n        format = 'csv',\n        fieldterminator ='0x0b',\n        fieldquote = '0x0b'\n    ) with (doc nvarchar(max)) as rows\ngo\n*/",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "koichinodb",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}